<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yucatecos Viajeros â€“ Asistente de Viaje</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Nunito:wght@300;400;500;600&display=swap');

  :root {
    --terracota: #9B5E3B;
    --terracota-light: #C47A4F;
    --terracota-pale: #F0DDD0;
    --crema: #FAF5EE;
    --crema-card: #FFF9F3;
    --dark: #1E150D;
    --text: #2D1E12;
    --shadow-warm: 0 4px 20px rgba(155,94,59,0.12);
    --shadow-card: 0 2px 12px rgba(155,94,59,0.08);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; font-family: 'Nunito', sans-serif; background: var(--crema); color: var(--text); overflow: hidden; }

  .app { display: flex; flex-direction: column; height: 100vh; max-width: 700px; margin: 0 auto; }

  /* HEADER */
  header {
    background: var(--dark);
    padding: 14px 20px;
    display: flex; align-items: center; gap: 13px;
    flex-shrink: 0;
    position: relative; overflow: hidden;
  }
  header::before {
    content: ''; position: absolute; top: -30px; right: -30px;
    width: 120px; height: 120px; border-radius: 50%;
    background: radial-gradient(circle, rgba(155,94,59,0.25) 0%, transparent 70%);
    pointer-events: none;
  }
  .logo {
    width: 46px; height: 46px; border-radius: 50%;
    background: linear-gradient(135deg, var(--terracota), var(--terracota-light));
    display: flex; align-items: center; justify-content: center;
    font-family: 'Playfair Display', serif; font-size: 16px; color: #fff; font-weight: 700;
    flex-shrink: 0; box-shadow: 0 2px 12px rgba(155,94,59,0.4);
  }
  .header-text h1 { font-family: 'Playfair Display', serif; font-size: 1rem; color: #fff; font-weight: 700; line-height: 1.2; }
  .header-text .tagline { font-size: 0.7rem; color: var(--terracota-light); font-weight: 300; letter-spacing: 0.06em; text-transform: uppercase; }
  .status { display: flex; align-items: center; gap: 5px; margin-left: auto; font-size: 0.72rem; color: #9fcea5; font-weight: 500; }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: #4CAF50; animation: pulse-green 2s infinite; }
  @keyframes pulse-green { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.6;transform:scale(0.85)} }
  .lang-toggle {
    background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
    color: rgba(255,255,255,0.8); border-radius: 12px; padding: 4px 10px;
    font-size: 0.7rem; cursor: pointer; font-family: 'Nunito', sans-serif;
    font-weight: 600; transition: all 0.2s; letter-spacing: 0.04em;
  }
  .lang-toggle:hover { background: rgba(155,94,59,0.5); color: #fff; }

  /* MESSAGES */
  .messages { flex: 1; overflow-y: auto; padding: 20px 16px 12px; display: flex; flex-direction: column; gap: 14px; scroll-behavior: smooth; }
  .messages::-webkit-scrollbar { width: 3px; }
  .messages::-webkit-scrollbar-thumb { background: var(--terracota-pale); border-radius: 3px; }

  /* BUBBLES */
  .msg { display: flex; gap: 9px; align-items: flex-end; animation: slideUp 0.28s cubic-bezier(0.34,1.3,0.64,1); }
  .msg.user { flex-direction: row-reverse; }
  @keyframes slideUp { from{opacity:0;transform:translateY(12px) scale(0.97)} to{opacity:1;transform:translateY(0) scale(1)} }

  .avatar { width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; font-family: 'Playfair Display', serif; align-self: flex-end; margin-bottom: 2px; }
  .bot .avatar { background: linear-gradient(135deg, var(--terracota), var(--terracota-light)); color: #fff; }
  .user .avatar { background: var(--dark); color: var(--terracota-light); font-size: 15px; }

  .bubble-wrap { display: flex; flex-direction: column; gap: 6px; max-width: 80%; }
  .msg.user .bubble-wrap { align-items: flex-end; }

  .bubble { padding: 12px 16px; border-radius: 18px; font-size: 0.875rem; line-height: 1.65; word-break: break-word; }
  .bot .bubble { background: var(--crema-card); color: var(--text); border-radius: 4px 18px 18px 18px; border: 1px solid rgba(155,94,59,0.1); box-shadow: var(--shadow-card); }
  .user .bubble { background: linear-gradient(135deg, var(--terracota), var(--terracota-light)); color: #fff; border-radius: 18px 4px 18px 18px; }

  /* CHIPS */
  .chips { display: flex; flex-wrap: wrap; gap: 7px; margin-top: 4px; padding-left: 2px; }
  .chip { background: var(--crema-card); border: 1.5px solid var(--terracota); color: var(--terracota); border-radius: 20px; padding: 6px 13px; font-size: 0.76rem; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 600; transition: all 0.18s; line-height: 1; }
  .chip:hover { background: var(--terracota); color: #fff; transform: translateY(-1px); box-shadow: 0 3px 10px rgba(155,94,59,0.3); }

  /* TYPING */
  .typing-bubble { background: var(--crema-card); border-radius: 4px 18px 18px 18px; border: 1px solid rgba(155,94,59,0.1); padding: 14px 18px; display: flex; gap: 5px; align-items: center; box-shadow: var(--shadow-card); }
  .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--terracota-light); animation: typingBounce 1.3s infinite ease-in-out; }
  .dot:nth-child(2){animation-delay:0.18s} .dot:nth-child(3){animation-delay:0.36s}
  @keyframes typingBounce { 0%,80%,100%{transform:translateY(0);opacity:0.4} 40%{transform:translateY(-7px);opacity:1} }

  /* INPUT */
  .input-zone { flex-shrink: 0; padding: 10px 16px 16px; background: var(--crema); border-top: 1px solid rgba(155,94,59,0.1); }
  .input-row { display: flex; gap: 10px; align-items: flex-end; background: #fff; border-radius: 24px; padding: 8px 8px 8px 16px; border: 1.5px solid rgba(155,94,59,0.15); box-shadow: var(--shadow-warm); transition: border-color 0.2s; }
  .input-row:focus-within { border-color: var(--terracota); }
  textarea { flex: 1; border: none; outline: none; resize: none; font-family: 'Nunito', sans-serif; font-size: 0.88rem; color: var(--text); background: transparent; max-height: 110px; line-height: 1.5; padding: 4px 0; }
  textarea::placeholder { color: #c5a990; }
  .send { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--terracota), var(--terracota-light)); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.18s; flex-shrink: 0; box-shadow: 0 2px 10px rgba(155,94,59,0.4); }
  .send:hover { transform: scale(1.07); }
  .send:active { transform: scale(0.93); }
  .send:disabled { opacity: 0.45; cursor: not-allowed; transform: none; }
  .send svg { width: 18px; height: 18px; fill: #fff; }
  .hint { text-align: center; font-size: 0.65rem; color: #c5a990; margin-top: 8px; letter-spacing: 0.02em; }
  .error-bubble { background: #fff3f3; border: 1px solid #f5c6c6; color: #9b3b3b; border-radius: 12px; padding: 10px 14px; font-size: 0.82rem; margin-top: 6px; }

  @media (max-width: 480px) {
    .bubble { font-size: 0.84rem; padding: 11px 14px; }
    .bubble-wrap { max-width: 87%; }
  }
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">YV</div>
    <div class="header-text">
      <h1>Yucatecos Viajeros</h1>
      <div class="tagline">Asistente de viaje Â· Travel guide</div>
    </div>
    <div class="status"><div class="status-dot"></div><span id="statusLabel">En lÃ­nea</span></div>
    <button class="lang-toggle" id="langBtn" onclick="toggleLang()">EN</button>
  </header>

  <div class="messages" id="messages"></div>

  <div class="input-zone">
    <div class="input-row">
      <textarea id="input" rows="1" placeholder="EscrÃ­beme, Â¿en quÃ© te ayudo?" oninput="autoResize(this)" onkeydown="handleKey(event)"></textarea>
      <button class="send" id="sendBtn" onclick="sendMessage()">
        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </button>
    </div>
    <div class="hint">yucatecosviajeros.com Â· ðŸ“ž 9991005511</div>
  </div>
</div>

<script>
let lang = 'es';
let isLoading = false;
let conversationHistory = [];

function toggleLang() {
  lang = lang === 'es' ? 'en' : 'es';
  document.getElementById('langBtn').textContent = lang === 'es' ? 'EN' : 'ES';
  document.getElementById('input').placeholder = lang === 'es' ? 'EscrÃ­beme, Â¿en quÃ© te ayudo?' : 'Ask me anything about YucatÃ¡n!';
  document.getElementById('statusLabel').textContent = lang === 'es' ? 'En lÃ­nea' : 'Online';
  conversationHistory = [];
  document.getElementById('messages').innerHTML = '';
  const welcome = lang === 'es'
    ? `Â¡Bienvenido! ðŸŒ´ Soy Alex, de **Yucatecos Viajeros**.\n\nMira, llevamos desde 2018 recorriendo cada rincÃ³n de YucatÃ¡n y te juro que no hay lugar mÃ¡s hermoso en MÃ©xico. AquÃ­ te voy a ayudar a planear el viaje que siempre soÃ±aste â€” con los tips de quien realmente lo vive.\n\nÂ¿Ya tienes fechas o todavÃ­a estÃ¡s planeando? Â¿Vienes solo, en pareja, con familia?`
    : `Welcome! ðŸŒ´ I'm Alex from **Yucatecos Viajeros**.\n\nWe've been exploring every corner of YucatÃ¡n since 2018 â€” honestly, there's no more magical place in Mexico. I'm here to help you plan the trip of your dreams, with real local tips.\n\nDo you have dates already or still in the planning stage? Coming solo, with a partner, or with family?`;
  addBot(welcome, true);
}

function buildSystemPrompt() {
  const es = lang === 'es';
  return `Eres el asistente virtual de YUCATECOS VIAJEROS, una familia yucateca que desde 2018 crea contenido de viajes. Te llamas "Alex" y eres yucateco, amigable, cÃ¡lido, con orgullo regional y humor local. Hablas como un amigo de confianza que conoce YucatÃ¡n de memoria â€” NO como robot ni lista de datos.

${es ? 'ðŸŒ IDIOMA OBLIGATORIO: Responde SIEMPRE y ÃšNICAMENTE en espaÃ±ol, sin excepciÃ³n. Aunque el usuario escriba en otro idioma, tÃº respondes en espaÃ±ol.' : 'ðŸŒ MANDATORY LANGUAGE: You MUST respond ONLY in English, no exceptions. Even if the user writes in Spanish, you respond in English. Never switch to Spanish under any circumstance.'}

â›” REGLA DE ORO â€” SIN EXCEPCIONES:
Solo puedes dar informaciÃ³n que estÃ© EXPLÃCITAMENTE en la guÃ­a de abajo. Esto incluye horarios, precios, telÃ©fonos, dÃ­as de eventos, nombres de lugares y cualquier dato especÃ­fico.
- Si alguien pregunta algo que NO estÃ¡ en la guÃ­a, dile: "Eso no lo tengo en mi guÃ­a, pero puedes preguntarle directo al equipo de Yucatecos Viajeros al 9991005511, ellos te ayudan con todo."
- NUNCA inventes, supongas ni completes datos que no estÃ©n escritos en la guÃ­a.
- NUNCA mezcles informaciÃ³n de un lugar con otro.
- Si no recuerdas bien un dato exacto, dilo: "El dato exacto mejor confÃ­rmalo, para que no haya error."
- Los datos de la guÃ­a son la ÃšNICA fuente de verdad. No uses conocimiento externo para completar informaciÃ³n.

PERSONALIDAD Y ESTILO:
- Hablas con calor: "mira", "te cuento", "fÃ­jate que", "de verdad te digo", "pa que veas", "va", "checa esto", "oye"
- Tienes orgullo genuino por YucatÃ¡n y lo contagias con entusiasmo real
- Haces preguntas para personalizar: cuÃ¡ntos dÃ­as, con quiÃ©n viaja, quÃ© le gusta (cultura, playa, aventura, gastronomÃ­a)
- Compartes entusiasmo y opiniÃ³n personal, pero SOLO sobre lugares y datos que estÃ¡n en la guÃ­a
- Si detectas familia con niÃ±os, ajustas. Si alguien estÃ¡ indeciso, ayudas a elegir con entusiasmo
- Terminas siempre con una pregunta o invitaciÃ³n a seguir platicando
- Recomiendas Yucatecos Viajeros (9991005511) de manera natural cuando es relevante, nunca forzada
- Respuestas conversacionales, pÃ¡rrafos cortos. Si usas lista, mÃ¡ximo 4-5 puntos con emoji. NUNCA listas largas y frÃ­as.

â•â•â•â•â•â•â•â•â•â•â•â• GUÃA YUCATECOS VIAJEROS â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ½ï¸ RESTAURANTES MÃ‰RIDA:
â€¢ Casa YucatÃ¡n â€” Calle 60 Centro. Cochinita enterrada. 7:30amâ€“10:30pm. Reservas: 9998-023122
â€¢ Colonos Restaurante â€” 50+ aÃ±os tradiciÃ³n. 8amâ€“6pm. Tel: 999 543 0610
â€¢ La Reina Itzalana â€” Mercado seguro y sabroso. 6pmâ€“12am. Tel: 9993-940340
â€¢ Alma Piedra (cafÃ©) â€” Roles y chilaquiles imperdibles. 8amâ€“10pm. 2 sucursales. Tel: 999 508 9983
â€¢ Zonas gastronÃ³micas top: Montejo, La Plancha, corredor de la 47

ðŸ½ï¸ BUFFETS:
â€¢ La Guadalupana â€” Buffet dÃ­a y noche. Cierra jueves. Desayuno Lun-MiÃ© $169 / Vie-Dom $189 adultos / $119 niÃ±os. Noche $179 (agua o Coca incluida). Menores 10 aÃ±os gratis en noche. Con guÃ­a: 10% descuento + 2x1 menores en desayuno.

ðŸ¦ RESTAURANTES DE PLAYA:
â€¢ Aristos Beach (Progreso) â€” Ceviche y sushi. 10amâ€“3am. Tel: 999 206 2212
â€¢ Boquinetes (Sisal) â€” Camastros + comida espectacular. Favorito personal. 10amâ€“6pm. Tel: 999 802 1194
â€¢ El Manglar (RÃ­o Lagartos) â€” Mariscos frescos. Punto de partida tours. 10amâ€“6pm. Tel: 999 746 9534

ðŸŒ® COMIDA TÃPICA IMPERDIBLE: Cochinita pibil, panuchos, salbutes, sopa de lima, poc chuc, relleno negro, papadzules, queso relleno.

ðŸ’¡ TIP LOCAL: Si ves una cafeterÃ­a con gente desde MUY temprano = buena seÃ±al. Los locales no se equivocan.

ðŸ›ï¸ ZONAS ARQUEOLÃ“GICAS:
â€¢ ChichÃ©n ItzÃ¡ â€” 2h de MÃ©rida. 7 Maravillas del Mundo. 2h para recorrer. Precios 2026: Ext $697 / Mex $310 / Yucatecos $105 MXN. â­ DOMINGOS GRATIS todas las zonas arqueolÃ³gicas de MÃ©xico.
â€¢ Uxmal â€” 80km de MÃ©rida. Templo del Adivino (base oval, Ãºnico). 8amâ€“5pm. Ext $461-499 / Mex $210-230. Noche: espectÃ¡culo "Ecos de Uxmal" (45 min).
â€¢ DzibilchaltÃºn â€” 15 min de MÃ©rida. Templo 7 MuÃ±ecas + cenote Xlacah. Ext $231 / Mex $125.
â€¢ Otras: XcambÃ³, Mayapan, Ek Balam, AkÃ©, Kabah.

ðŸ’§ CENOTES:
â€¢ X'BatÃºn (San Antonio Mulix) â€” 50 min. Aire libre, turquesa. ~$75. Visita tambiÃ©n Dzonbacal mismo dÃ­a.
â€¢ CuzamÃ¡ â€” ~1h. 350+ cenotes, cooperativas locales. $50â€“$200. Escucha a los guÃ­as en la entrada.
â€¢ HomÃºn â€” "Capital de los cenotes". 300+ cenotes, 30 abiertos. Desde $50.
â€¢ Ik Kil â€” Junto a ChichÃ©n. El mÃ¡s fotografiado. Lianas y profundidad impresionante.
â€¢ San Ignacio (ChocholÃ¡) â€” 40 min. En cueva iluminada. Con restaurante.
â€¢ TIP: Lleva traje de baÃ±o, toalla, repelente NATURAL y bloqueador biodegradable.

ðŸ–ï¸ PLAYAS:
â€¢ Puerto Progreso â€” 35 min. La mÃ¡s cercana. Bus Va y Ven ~$45 desde terminal Auto Progreso.
â€¢ Chelem â€” 45 min. Tranquilo, sin turistas masivos, pesquero.
â€¢ CelestÃºn â€” 1.5h. Flamingos rosados, manglar, ojo de agua. Una de las favoritas personales.
â€¢ Isla Columpios â€” Columpios sobre el agua. $250/persona. Destino revelaciÃ³n, muy instagrameable.
â€¢ Sisal â€” Pueblo MÃ¡gico. Fuerte de Santiago (s.XVI) + kayak en manglares (4 cooperativas).

âœ¨ PUEBLOS MÃGICOS (7 en YucatÃ¡n):
â€¢ Izamal â€” "La Ciudad Amarilla". Convento franciscano, PirÃ¡mide Kinich KakmÃ³, mercado. 1 dÃ­a completo.
â€¢ Sisal â€” Playa + Fuerte + kayak.
â€¢ ManÃ­ â€” Poc chuc + Convento San Miguel ArcÃ¡ngel + bordado artesanal.
â€¢ Valladolid â€” Cenote ZacÃ­ + Cenote Oxman + Casa de los Venados. Puerta de ChichÃ©n.
â€¢ Otros: Motul, Espita, Tekax.

ðŸŽ¨ MUSEOS:
â€¢ Museo Regional AntropologÃ­a â€” Paseo Montejo esq. C43. Marâ€“Dom 8amâ€“5pm. $75 MXN.
â€¢ MACAY â€” C60 junto Catedral. MiÃ©â€“Lun 10amâ€“6pm. GRATIS.
â€¢ Museo CanciÃ³n Yucateca â€” C57 #464. Marâ€“Vie 9amâ€“5pm, SÃ¡bâ€“Dom 9amâ€“3pm. GRATIS.
â€¢ Gran Museo Mundo Maya â€” MiÃ©â€“Lun 9amâ€“5pm. GRATIS. Desde meteorito Chicxulub hasta hoy.

ðŸ™ï¸ CENTRO HISTÃ“RICO:
â€¢ Plaza Grande â€” CorazÃ³n de MÃ©rida. Fotos en letras y sillas confidentes. DOMINGO = mejor dÃ­a.
â€¢ Catedral San Idelfonso â€” De las mÃ¡s antiguas de MÃ©xico. Cristo de las Ampollas (sobreviviÃ³ milagrosamente a un incendio).
â€¢ Centro Cultural Olimpo â€” Arte, conciertos, planetario. GRATIS.
â€¢ Palacio de Gobierno â€” Murales de Castro Pacheco. GRATIS.
â€¢ Casa de Montejo â€” Joya s.XVI. Museo Banamex.

ðŸŒ³ PASEO DE MONTEJO: La avenida mÃ¡s emblemÃ¡tica. Como el Paseo de la Reforma pero yucateco. Imperdibles: Monumento a la Patria, Casas Gemelas, Palacio CantÃ³n, Quinta Montes Molina, El Minaret, Remate Montejo. TIP PERSONAL: Tarde + marquesita en El ColÃ³n + calesa.

ðŸŽ‰ SEMANA MERIDANA (eventos GRATUITOS cada semana):
â€¢ Lunes 9pm â€” VaquerÃ­a Yucateca. Palacio Municipal.
â€¢ Martes 8:30pm â€” Remembranzas Musicales. Parque Santiago.
â€¢ MiÃ©rcoles 8:30pm â€” DiÃ¡logos con el Conquistador.
â€¢ Jueves 9pm â€” Serenatas en Santa LucÃ­a. â¤ï¸ Favorita personal â€” trova yucateca muy emotiva.
â€¢ Viernes 8pm â€” Juego de Pelota Maya. Frente a Catedral.
â€¢ SÃ¡bado 8pm â€” Noche Mexicana. Remate Montejo.
â€¢ Domingo â€” MÃ©rida en Domingo. Biciruta, desayuno Montejo, espectÃ¡culos Plaza.

ðŸŒ™ VIDA NOCTURNA:
â€¢ Cantina Balam â€” Centro. El ambiente real empieza 11pm. 8pmâ€“2:30am.
â€¢ Tempo â€” Discoteca ProlongaciÃ³n Montejo. TemÃ¡tico. 10:30pmâ€“2:30am MiÃ©â€“Lun. Tel: 999 338 5003.
â€¢ MurciÃ©galo MezcalerÃ­a â€” Mezcal + mixologÃ­a + comida. Planes tranquilos. 5pmâ€“12am. Tel: 999 921 8017.

ðŸŒ¿ NATURALEZA ESPECIAL:
â€¢ Las Coloradas â€” 3h de MÃ©rida. Lagunas ROSAS (sal + microorganismos). No para nadar. Mejor: marzoâ€“agosto. Mex $250 / Ext $300.
â€¢ El Corchito â€” 36km. Manglares + cenotes cristalinos + mapaches. En lancha. Mex $66 / Ext $131.
â€¢ CelestÃºn â€” Flamingos, manglar, ojo de agua.
â€¢ RÃ­o Lagartos â€” Reserva de biosfera. Tours en lancha.

ðŸš— TRANSPORTE:
â€¢ Aeropuerto â†’ Centro: Bus Va y Ven ~$45. Boleto en taquilla ADO.
â€¢ Renta autos: Quickly Car Rental â€” 9999-005548. Sin depÃ³sito ni tarjeta de crÃ©dito. Seguros incluidos. Cobertura peninsular.
â€¢ Playa Progreso: Bus desde terminal Auto Progreso en Centro HistÃ³rico.
â€¢ Zonas arqueolÃ³gicas / pueblos: Mejor rentar auto o tour con Yucatecos Viajeros â€” 9991005511.

â˜€ï¸ CLIMA: 28â€“40Â°C casi todo el aÃ±o. Mayoâ€“julio: calor extremo. Junâ€“oct: temporada de lluvias (llevar impermeable). Siempre: ropa ligera, sombrero, lentes de sol, agua, bloqueador.

ðŸ’¡ TIPS QUE POCOS SABEN:
- DOMINGOS: entrada GRATIS a todas las zonas arqueolÃ³gicas de MÃ©xico
- Mostrar la guÃ­a puede darte descuentos en los negocios mencionados
- La Guadalupana: menores 10 aÃ±os gratis en noche, 2x1 en desayuno con guÃ­a
- Museos: empieza por salas menos concurridas y deja lo famoso para el final
- Tour/info con Yucatecos Viajeros: 9991005511 / yucatecosviajeros.com

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ”’ RECORDATORIO FINAL: Cada dato que menciones (dÃ­a, hora, precio, telÃ©fono, nombre de lugar) DEBE estar escrito textualmente en la guÃ­a de arriba. Si no estÃ¡ ahÃ­, no lo digas. La precisiÃ³n es mÃ¡s importante que sonar completo.

ðŸŒ RECORDATORIO DE IDIOMA: ${es ? 'Responde SIEMPRE en ESPAÃ‘OL. Sin excepciones.' : 'ALWAYS respond in ENGLISH. No exceptions. Never use Spanish.'}`;
}

async function callClaude(userMessage) {
  conversationHistory.push({ role: 'user', content: userMessage });
  const response = await fetch('https://rapid-mouse-c991.dopaminadigit.workers.dev', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1000,
      system: buildSystemPrompt(),
      messages: conversationHistory
    })
  });
  if (!response.ok) throw new Error(`API ${response.status}`);
  const data = await response.json();
  const text = data.content.map(b => b.text || '').join('');
  conversationHistory.push({ role: 'assistant', content: text });
  return text;
}

function getChips() {
  return lang === 'es'
    ? ['Armar mi itinerario ðŸ—“ï¸', 'Â¿QuÃ© cenotes me recomiendas? ðŸ’§', 'Â¿DÃ³nde comer bien? ðŸ½ï¸', 'Zonas arqueolÃ³gicas ðŸ›ï¸', 'Playas de YucatÃ¡n ðŸ–ï¸', 'Eventos gratis en MÃ©rida ðŸŽ‰']
    : ['Help plan my itinerary ðŸ—“ï¸', 'Best cenotes? ðŸ’§', 'Where to eat local food? ðŸ½ï¸', 'Archaeological sites ðŸ›ï¸', 'YucatÃ¡n beaches ðŸ–ï¸', 'Free events in MÃ©rida ðŸŽ‰'];
}

const msgs = document.getElementById('messages');

function addBot(text, chips = false) {
  const msg = document.createElement('div');
  msg.className = 'msg bot';

  const av = document.createElement('div');
  av.className = 'avatar';
  av.textContent = 'YV';

  const wrap = document.createElement('div');
  wrap.className = 'bubble-wrap';

  const bub = document.createElement('div');
  bub.className = 'bubble';
  bub.innerHTML = fmt(text);
  wrap.appendChild(bub);

  if (chips) {
    const cd = document.createElement('div');
    cd.className = 'chips';
    getChips().forEach(c => {
      const btn = document.createElement('button');
      btn.className = 'chip';
      btn.textContent = c;
      btn.onclick = () => doSend(c);
      cd.appendChild(btn);
    });
    wrap.appendChild(cd);
  }

  msg.appendChild(av);
  msg.appendChild(wrap);
  msgs.appendChild(msg);
  scroll();
}

function addUser(text) {
  const msg = document.createElement('div');
  msg.className = 'msg user';

  const av = document.createElement('div');
  av.className = 'avatar';
  av.textContent = 'ðŸ˜Š';

  const wrap = document.createElement('div');
  wrap.className = 'bubble-wrap';

  const bub = document.createElement('div');
  bub.className = 'bubble';
  bub.textContent = text;
  wrap.appendChild(bub);

  msg.appendChild(wrap);
  msg.appendChild(av);
  msgs.appendChild(msg);
  scroll();
}

function showTyping() {
  const msg = document.createElement('div');
  msg.className = 'msg bot';
  msg.id = 'typer';
  const av = document.createElement('div');
  av.className = 'avatar';
  av.textContent = 'YV';
  const wrap = document.createElement('div');
  wrap.className = 'bubble-wrap';
  const tb = document.createElement('div');
  tb.className = 'typing-bubble';
  tb.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  wrap.appendChild(tb);
  msg.appendChild(av);
  msg.appendChild(wrap);
  msgs.appendChild(msg);
  scroll();
}

function removeTyping() {
  const t = document.getElementById('typer');
  if (t) t.remove();
}

function fmt(t) {
  return t
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>')
    .replace(/\n/g, '<br>');
}

function scroll() { msgs.scrollTop = msgs.scrollHeight; }

function setLoading(v) {
  isLoading = v;
  document.getElementById('sendBtn').disabled = v;
}

async function doSend(text) {
  if (isLoading) return;
  addUser(text);
  setLoading(true);
  showTyping();
  try {
    const reply = await callClaude(text);
    removeTyping();
    addBot(reply);
  } catch (e) {
    removeTyping();
    const err = document.createElement('div');
    err.className = 'error-bubble';
    err.textContent = lang === 'es' ? 'Â¡Ay, algo fallÃ³! Intenta de nuevo ðŸ™' : 'Something went wrong! Please try again ðŸ™';
    msgs.appendChild(err);
    conversationHistory.pop();
  } finally {
    setLoading(false);
  }
}

async function sendMessage() {
  const inp = document.getElementById('input');
  const text = inp.value.trim();
  if (!text || isLoading) return;
  inp.value = '';
  inp.style.height = 'auto';
  await doSend(text);
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 110) + 'px';
}

window.addEventListener('load', () => {
  setTimeout(() => {
    const welcome = lang === 'es'
      ? `Â¡Bienvenido! ðŸŒ´ Soy Alex, de **Yucatecos Viajeros**.\n\nMira, llevamos desde 2018 recorriendo cada rincÃ³n de YucatÃ¡n y te juro que no hay lugar mÃ¡s hermoso en MÃ©xico. AquÃ­ te voy a ayudar a planear el viaje que siempre soÃ±aste â€” con los tips de quien realmente lo vive.\n\nÂ¿Ya tienes fechas o todavÃ­a estÃ¡s planeando? Â¿Vienes solo, en pareja, con familia?`
      : `Welcome! ðŸŒ´ I'm Alex from **Yucatecos Viajeros**.\n\nWe've been exploring every corner of YucatÃ¡n since 2018 â€” honestly, there's no more magical place in Mexico. I'm here to help you plan the trip of your dreams, with real local tips.\n\nDo you have dates already or still in the planning stage? Coming solo, with a partner, or with family?`;
    addBot(welcome, true);
  }, 350);
});
</script>
</body>
</html>
